#!/bin/bash

set -e
set -u

HOST=$1
PORT=$2
USER=$3
PASSWORD=$4

rm -rf ~/.ssh
mkdir ~/.ssh
chmod 700 ~/.ssh
touch ~/.ssh/config
chmod 600 ~/.ssh/config
echo "StrictHostKeyChecking no" >> ~/.ssh/config
ssh-keygen -f ~/.ssh/id_dsa -t dsa -N ''
/var/vcap/packages/sshpass/sshpass -p $PASSWORD ssh-copy-id -i ~/.ssh/id_dsa.pub -p $PORT $USER@$HOST
rm ~/.ssh/id_dsa.pub