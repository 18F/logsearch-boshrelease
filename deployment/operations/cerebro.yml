---
- type: replace
  path: /instance_groups/name=elasticsearch_master/jobs/-
  value:
    name: cerebro
    release: logsearch
    consumes:
      elasticsearch: {from: elasticsearch_master}
    properties:
      cerebro:
        secret: ((cerebro_secret_key))

- type: replace
  path: /instance_groups/name=ls-router/jobs/name=haproxy/properties?/haproxy/elastic
  value:
    auth:
      username: cerebro
      password: ((cerebro_auth_password))
    inbound_port: 9000

- type: replace
  path: /instance_groups/name=ls-router/jobs/name=route_registrar/properties/route_registrar/routes/-
  value:
    name: cerebro
    port: 9000
    registration_interval: 60s
    uris:
      - "cerebro.((system_domain))"

# --- define secrets for cerebro
- type: replace
  path: /variables/-
  value:
    name: cerebro_secret_key
    type: password

- type: replace
  path: /variables/-
  value:
    name: cerebro_auth_password
    type: password
